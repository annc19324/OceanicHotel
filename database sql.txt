database sql
CREATE TABLE Users 
(
    user_id INT IDENTITY(1,1) PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL, -- Lưu password đã được hash
    email VARCHAR(100) UNIQUE NOT NULL,
    role VARCHAR(20) CHECK (role IN ('admin', 'user')) DEFAULT 'user', -- Thay thế ENUM bằng VARCHAR
    avatar VARCHAR(255), -- Đường dẫn đến ảnh đại diện (có thể NULL)
    is_active BIT DEFAULT 1, -- Tài khoản có hoạt động hay không (Sử dụng BIT thay vì BOOLEAN)
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP -- Sử dụng DATETIME thay vì TIMESTAMP
);


CREATE TABLE Rooms
(
    room_id INT IDENTITY(1,1) PRIMARY KEY, -- Auto-increment primary key
    room_number VARCHAR(10) UNIQUE NOT NULL,
    room_type VARCHAR(20) CHECK (room_type IN ('Single', 'Double', 'Suite', 'Deluxe')) NOT NULL, -- Thay ENUM bằng VARCHAR và CHECK constraint
    price_per_night DECIMAL(10, 2) NOT NULL,
    is_available BIT DEFAULT 1, -- Phòng còn trống hay không (BOOLEAN → BIT)
    description TEXT,
    image_url VARCHAR(255), -- Đường dẫn đến hình ảnh phòng
    max_occupancy INT NOT NULL, -- Số người tối đa
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP -- Thay TIMESTAMP bằng DATETIME
);



CREATE TABLE Bookings
(
    booking_id INT IDENTITY(1,1) PRIMARY KEY,
    user_id INT NOT NULL,
    room_id INT NOT NULL,
    check_in_date DATE NOT NULL,
    check_out_date DATE NOT NULL,
    total_price DECIMAL(10, 2) NOT NULL,
    status VARCHAR(20) CHECK (status IN ('Pending', 'Confirmed', 'Cancelled')) DEFAULT 'Pending', -- Thay thế ENUM bằng VARCHAR
    num_adults INT NOT NULL DEFAULT 1, -- Số người lớn, mặc định 1
    num_children INT NOT NULL DEFAULT 0, -- Số trẻ em, mặc định 0
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Sử dụng DATETIME thay vì TIMESTAMP
    FOREIGN KEY (user_id) REFERENCES Users(user_id),
    FOREIGN KEY (room_id) REFERENCES Rooms(room_id)
);


CREATE TABLE Booking_History 
(
    history_id INT IDENTITY(1,1) PRIMARY KEY,
    booking_id INT NOT NULL, -- Tham chiếu đến đặt phòng
    changed_by INT NOT NULL, -- Người thực hiện thay đổi (admin hoặc user)
    old_status VARCHAR(20) CHECK (old_status IN ('Pending', 'Confirmed', 'Cancelled')), -- Thay thế ENUM bằng VARCHAR
    new_status VARCHAR(20) CHECK (new_status IN ('Pending', 'Confirmed', 'Cancelled')), -- Thay thế ENUM bằng VARCHAR
    changed_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Sử dụng DATETIME thay vì TIMESTAMP
    FOREIGN KEY (booking_id) REFERENCES Bookings(booking_id),
    FOREIGN KEY (changed_by) REFERENCES Users(user_id)
);


CREATE TABLE Room_Edit_History 
(
    history_id INT IDENTITY(1,1) PRIMARY KEY,
    room_id INT NOT NULL, -- Tham chiếu đến phòng
    changed_by INT NOT NULL, -- Người thực hiện thay đổi (admin)
    change_description TEXT NOT NULL, -- Mô tả thay đổi (ví dụ: "Giá phòng thay đổi từ 500,000 VND lên 600,000 VND")
    changed_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Sử dụng DATETIME thay vì TIMESTAMP
    FOREIGN KEY (room_id) REFERENCES Rooms(room_id),
    FOREIGN KEY (changed_by) REFERENCES Users(user_id)
);


CREATE TABLE Login_History 
(
    login_id INT IDENTITY(1,1) PRIMARY KEY,
    user_id INT NOT NULL, -- Tham chiếu đến người dùng
    login_time DATETIME DEFAULT CURRENT_TIMESTAMP, -- Thời gian đăng nhập, sử dụng DATETIME
    ip_address VARCHAR(45), -- Địa chỉ IP
    FOREIGN KEY (user_id) REFERENCES Users(user_id)
);


CREATE TABLE Transactions 
(
    transaction_id INT IDENTITY(1,1) PRIMARY KEY,
    booking_id INT NOT NULL, -- Tham chiếu đến đặt phòng
    user_id INT NOT NULL, -- Người thực hiện giao dịch
    amount DECIMAL(10, 2) NOT NULL, -- Số tiền giao dịch
    status VARCHAR(20) CHECK (status IN ('Success', 'Failed', 'Pending')) DEFAULT 'Pending', -- Thay thế ENUM bằng VARCHAR
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Sử dụng DATETIME thay vì TIMESTAMP
    FOREIGN KEY (booking_id) REFERENCES Bookings(booking_id),
    FOREIGN KEY (user_id) REFERENCES Users(user_id)
);


CREATE TABLE Settings 
(
    setting_id INT IDENTITY(1,1) PRIMARY KEY,
    setting_key VARCHAR(50) NOT NULL UNIQUE, -- Ví dụ: 'default_language', 'default_theme'
    setting_value VARCHAR(255) NOT NULL, -- Ví dụ: 'en', 'light'
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP -- Sử dụng DATETIME thay vì TIMESTAMP
);


CREATE TABLE Reviews
(
    review_id INT IDENTITY(1,1) PRIMARY KEY, -- Auto-increment primary key
    booking_id INT NOT NULL,
    user_id INT NOT NULL,
    rating INT CHECK (rating >= 1 AND rating <= 5), -- Điểm đánh giá từ 1-5
    comment TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP, -- Thay TIMESTAMP bằng DATETIME
    FOREIGN KEY (booking_id) REFERENCES Bookings(booking_id),
    FOREIGN KEY (user_id) REFERENCES Users(user_id)
);


