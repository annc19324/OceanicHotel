CREATE DATABASE OceanHotel;

USE OceanHotel;

-- Bảng Users (giữ nguyên từ bạn)
CREATE TABLE Users 
(
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL, -- Lưu password đã được hash
    email VARCHAR(100) UNIQUE NOT NULL,
    role ENUM('admin', 'user') DEFAULT 'user',
    avatar VARCHAR(255), -- Đường dẫn đến ảnh đại diện (có thể NULL)
    is_active BOOLEAN DEFAULT TRUE, -- Tài khoản có hoạt động hay không
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Bảng Rooms (giữ nguyên từ bạn)
CREATE TABLE Rooms 
(
    room_id INT AUTO_INCREMENT PRIMARY KEY,
    room_number VARCHAR(10) UNIQUE NOT NULL, -- Ví dụ: 101, 102, 201, 202,...
    room_type ENUM('Single', 'Double', 'Suite', 'Deluxe') NOT NULL,
    price_per_night DECIMAL(10, 2) NOT NULL, -- Giá phòng theo đêm
    is_available BOOLEAN DEFAULT TRUE, -- Phòng còn trống hay không
    description TEXT, -- Mô tả thêm về phòng (có thể NULL)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Bảng Bookings (giữ nguyên từ bạn)
CREATE TABLE Bookings
(
    booking_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL, -- Người đặt phòng
    room_id INT NOT NULL, -- Phòng được đặt
    check_in_date DATE NOT NULL, -- Ngày nhận phòng
    check_out_date DATE NOT NULL, -- Ngày trả phòng
    total_price DECIMAL(10, 2) NOT NULL, -- Tổng giá (tính từ số ngày và giá phòng)
    status ENUM('Pending', 'Confirmed', 'Cancelled') DEFAULT 'Pending', -- Trạng thái đặt phòng
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES Users(user_id),
    FOREIGN KEY (room_id) REFERENCES Rooms(room_id)
);

-- Bảng Booking_History (giữ nguyên từ bạn)
CREATE TABLE Booking_History 
(
    history_id INT AUTO_INCREMENT PRIMARY KEY,
    booking_id INT NOT NULL, -- Tham chiếu đến đặt phòng
    changed_by INT NOT NULL, -- Người thực hiện thay đổi (admin hoặc user)
    old_status ENUM('Pending', 'Confirmed', 'Cancelled'), -- Trạng thái cũ
    new_status ENUM('Pending', 'Confirmed', 'Cancelled'), -- Trạng thái mới
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Thời gian thay đổi
    FOREIGN KEY (booking_id) REFERENCES Bookings(booking_id),
    FOREIGN KEY (changed_by) REFERENCES Users(user_id)
);

-- Bảng Room_Edit_History (giữ nguyên từ bạn)
CREATE TABLE Room_Edit_History 
(
    history_id INT AUTO_INCREMENT PRIMARY KEY,
    room_id INT NOT NULL, -- Tham chiếu đến phòng
    changed_by INT NOT NULL, -- Người thực hiện thay đổi (admin)
    change_description TEXT NOT NULL, -- Mô tả thay đổi (ví dụ: "Giá phòng thay đổi từ 500,000 VND lên 600,000 VND")
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Thời gian thay đổi
    FOREIGN KEY (room_id) REFERENCES Rooms(room_id),
    FOREIGN KEY (changed_by) REFERENCES Users(user_id)
);

-- Bảng Login_History (giữ nguyên từ bạn)
CREATE TABLE Login_History 
(
    login_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL, -- Tham chiếu đến người dùng
    login_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Thời gian đăng nhập
    ip_address VARCHAR(45), -- Địa chỉ IP
    FOREIGN KEY (user_id) REFERENCES Users(user_id)
);

-- Bảng Transactions (bổ sung từ tôi)
CREATE TABLE Transactions 
(
    transaction_id INT AUTO_INCREMENT PRIMARY KEY,
    booking_id INT NOT NULL, -- Tham chiếu đến đặt phòng
    user_id INT NOT NULL, -- Người thực hiện giao dịch
    amount DECIMAL(10, 2) NOT NULL, -- Số tiền giao dịch
    status ENUM('Success', 'Failed', 'Pending') DEFAULT 'Pending', -- Trạng thái giao dịch
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (booking_id) REFERENCES Bookings(booking_id),
    FOREIGN KEY (user_id) REFERENCES Users(user_id)
);

-- Bảng Settings (bổ sung từ tôi)
CREATE TABLE Settings 
(
    setting_id INT AUTO_INCREMENT PRIMARY KEY,
    setting_key VARCHAR(50) NOT NULL UNIQUE, -- Ví dụ: 'default_language', 'default_theme'
    setting_value VARCHAR(255) NOT NULL, -- Ví dụ: 'en', 'light'
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);